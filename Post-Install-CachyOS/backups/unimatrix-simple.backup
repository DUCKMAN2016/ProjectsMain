#!/bin/bash
# Simple dual monitor unimatrix with launcher control

# Check if we're already in a dedicated tab, if not, open one
if [ -z "$UNIMATRIX_LAUNCHER" ]; then
    export UNIMATRIX_LAUNCHER=1
    konsole --new-tab -e bash -c "$0; exec bash" &
    exit
fi

echo "=== Simple Dual Monitor Unimatrix ==="
echo ""

echo "Launching two unimatrix windows..."
echo ""

# Launch first unimatrix
konsole --profile Unimatrix --hide-menubar --hide-tabbar -e unimatrix -c green -l k &
UNIMATRIX1_PID=$!
sleep 1

# Launch second unimatrix  
konsole --profile Unimatrix --hide-menubar --hide-tabbar -e unimatrix -c green -l k &
UNIMATRIX2_PID=$!
sleep 2

echo ""
echo "SETUP INSTRUCTIONS:"
echo "1. You now have TWO unimatrix windows"
echo "2. Drag ONE window to your second monitor"
echo "3. Press F11 on BOTH windows to make them fullscreen"
echo "4. Press Ctrl+C HERE to close BOTH unimatrix windows"
echo ""
echo "Unimatrix windows running with PIDs: $UNIMATRIX1_PID and $UNIMATRIX2_PID"
echo "Press Ctrl+C in this launcher tab to close both windows."
echo ""

# Set up trap to clean up on exit
cleanup() {
    echo ""
    echo "Closing unimatrix windows..."
    kill $UNIMATRIX1_PID $UNIMATRIX2_PID 2>/dev/null
    exit 0
}

trap cleanup SIGINT SIGTERM

# Wait for the unimatrix processes or for user to press Ctrl+C
wait $UNIMATRIX1_PID $UNIMATRIX2_PID 2>/dev/null
cleanup
